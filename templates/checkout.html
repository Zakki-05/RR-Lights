{% extends 'base.html' %}

{% block title %}Checkout - RR Light House{% endblock %}

{% block content %}
<section class="section-padding">
    <div class="container">
        <h2 class="section-title">Checkout</h2>

        <div class="dashboard-card" style="max-width: 600px; margin: 0 auto;">
            <form id="checkout-form">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="name" required placeholder="John Doe">
                </div>

                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="phone" required placeholder="+91 98765 43210">
                </div>

                <div class="form-group">
                    <label>Shipping Address</label>
                    <textarea id="address" rows="4" required
                        placeholder="Enter your full delivery address..."></textarea>
                </div>

                <div class="form-group">
                    <label>Payment Method</label>
                    <select disabled style="background: var(--bg-color); opacity: 0.7;">
                        <option selected>Cash on Delivery (COD)</option>
                    </select>
                    <small style="color: var(--primary);">* Only COD is available currently.</small>
                </div>

                <button type="submit" class="btn" style="width: 100%;">Place Order</button>
            </form>
        </div>
    </div>
</section>

<div id="success-modal" class="modal">
    <div class="modal-content" style="text-align: center;">
        <i class="fa-solid fa-check-circle" style="font-size: 4rem; color: #4caf50; margin-bottom: 1rem;"></i>
        <h2>Order Placed Successfully!</h2>
        <p>Thank you for shopping with us. We will contact you shortly to confirm your order.</p>
        <p>Order ID: <strong id="order-id-display">#123</strong></p>
        <button class="btn" onclick="window.location.href='/'">Return to Home</button>
    </div>
</div>

<script>
    document.getElementById('checkout-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const data = {
            name: document.getElementById('name').value,
            phone: document.getElementById('phone').value,
            address: document.getElementById('address').value
        };

        try {
            const response = await fetch('/api/checkout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (result.success) {
                document.getElementById('order-id-display').textContent = '#' + result.order_id;
                document.getElementById('success-modal').style.display = 'flex';
            } else {
                alert(result.error || 'Checkout failed. Please try again.');
            }
        } catch (err) {
            console.error(err);
            alert('An error occurred. Please try again.');
        }
    });
</script>
{% endblock %}